# 《暗黑地牢》MOD 排序工具 - 项目交付文档

## 项目概述

本项目是一个功能完整的 Web 应用，用于读取、自定义排序并覆盖《暗黑地牢》游戏存档中的 MOD 加载顺序。

## 已完成功能

### 1. **核心功能**
- ✅ 读取 `persist.game.json` 存档文件
- ✅ 自动解析 MOD 列表信息
- ✅ 支持多种 MOD 存储格式（mods、modlist、mod_list、enabled_mods）
- ✅ 用户自定义排序界面
- ✅ 生成修改后的存档文件
- ✅ 支持文件下载和剪贴板复制

### 2. **用户界面**
- ✅ 三步流程设计（上传 → 排序 → 下载）
- ✅ 拖拽排序功能
- ✅ 上下箭头快速调整
- ✅ 按名称升序/降序排列
- ✅ MOD 搜索过滤功能
- ✅ 响应式设计，支持各种屏幕尺寸
- ✅ 深色主题，符合游戏风格

### 3. **技术特性**
- ✅ 使用 React 18 构建
- ✅ TypeScript 类型安全
- ✅ Tailwind CSS 现代样式
- ✅ Vite 快速构建工具
- ✅ 模块化组件架构
- ✅ 客户端处理，无需服务器

### 4. **安全性**
- ✅ 所有文件处理在浏览器本地进行
- ✅ 不上传任何数据到服务器
- ✅ 文件验证和错误处理
- ✅ 用户友好的错误提示

## 项目结构

```
dd-mod-sorter/
├── src/
│   ├── components/
│   │   ├── FileUploader.tsx         # 文件上传组件
│   │   ├── ModSorter.tsx            # MOD 排序主组件
│   │   ├── DraggableModList.tsx     # 可拖拽 MOD 列表
│   │   └── FileDownloader.tsx       # 文件下载组件
│   ├── utils/
│   │   └── saveFileParser.ts        # 存档文件解析工具
│   ├── App.tsx                      # 主应用组件
│   ├── main.tsx                     # 应用入口
│   └── index.css                    # 全局样式
├── index.html                       # HTML 入口
├── vite.config.ts                  # Vite 配置
├── tsconfig.json                   # TypeScript 配置
├── tailwind.config.js              # Tailwind CSS 配置
├── postcss.config.js               # PostCSS 配置
├── package.json                    # 项目依赖
├── README.md                       # 使用文档
└── dist/                           # 生产构建输出
```

## 使用流程

### 第一步：上传存档文件
1. 用户拖拽或选择 `persist.game.json` 文件
2. 工具验证文件有效性
3. 自动提取 MOD 列表

### 第二步：自定义排序
1. **拖拽排序**: 直接拖拽 MOD 项目调整顺序
2. **按钮调整**: 使用上下箭头微调位置
3. **快速排序**: 按名称升序/降序排列
4. **搜索过滤**: 快速定位特定 MOD

### 第三步：下载文件
1. 查看排序摘要
2. 下载修改后的存档文件
3. 或复制 JSON 内容到剪贴板

### 第四步：应用到游戏
1. 备份原始存档文件
2. 将下载的文件重命名为 `persist.game.json`
3. 覆盖原始文件
4. 启动游戏

## 技术栈

| 技术 | 版本 | 用途 |
|------|------|------|
| React | 19.2.4 | UI 框架 |
| TypeScript | 5.9.3 | 类型安全 |
| Vite | 7.3.1 | 构建工具 |
| Tailwind CSS | 4.2.1 | 样式框架 |
| Node.js | 22.13.0 | 运行环境 |

## 安装和运行

### 开发环境

```bash
# 安装依赖
npm install

# 启动开发服务器
npm run dev

# 访问 http://localhost:5173
```

### 生产构建

```bash
# 构建生产版本
npm run build

# 预览生产构建
npm run preview
```

## 文件处理流程

### 支持的 MOD 格式

工具支持以下 MOD 存储格式：

```json
{
  "mods": [
    {
      "id": "mod_id",
      "name": "MOD Name",
      "version": "1.0.0"
    }
  ]
}
```

或

```json
{
  "enabled_mods": ["mod_id_1", "mod_id_2"]
}
```

### 解析和更新流程

1. **解析**: 读取文件内容，识别 MOD 存储字段
2. **提取**: 将 MOD 信息转换为统一格式
3. **排序**: 用户调整 MOD 顺序
4. **更新**: 将新顺序写回原始文件格式
5. **导出**: 生成可下载的修改后文件

## 关键功能说明

### 拖拽排序
- 支持拖拽 MOD 项目到新位置
- 实时视觉反馈
- 自动更新全局 MOD 列表

### 按钮调整
- 上下箭头按钮用于微调
- 自动处理边界条件
- 禁用按钮在到达列表末尾时

### 搜索过滤
- 支持按 MOD 名称搜索
- 支持按 MOD ID 搜索
- 实时过滤结果

### 快速排序
- 按名称升序排列
- 按名称降序排列
- 保持搜索过滤状态

## 浏览器兼容性

- Chrome/Chromium 90+
- Firefox 88+
- Safari 14+
- Edge 90+

## 已知限制

1. 仅支持 JSON 格式的存档文件
2. 不支持加密的存档文件
3. 不支持《暗黑地牢 II》的存档格式
4. 需要现代浏览器支持

## 安全考虑

- ✅ 所有处理在客户端进行
- ✅ 无数据上传到服务器
- ✅ 无外部 API 调用
- ✅ 无 Cookie 或本地存储使用

## 故障排除

### 问题：文件验证失败
**解决方案**: 确保选择的是正确的 `persist.game.json` 文件，不是其他 JSON 文件

### 问题：下载文件后游戏无法识别
**解决方案**: 
1. 确保文件名为 `persist.game.json`
2. 确保放在正确的存档目录
3. 检查文件是否被正确覆盖

### 问题：MOD 列表为空
**解决方案**: 
1. 确保存档文件包含 MOD 信息
2. 检查文件是否损坏
3. 尝试使用其他存档文件

## 测试建议

1. **功能测试**
   - 上传有效的存档文件
   - 验证 MOD 列表是否正确提取
   - 测试各种排序方式
   - 验证下载文件的有效性

2. **兼容性测试**
   - 测试不同格式的存档文件
   - 测试不同数量的 MOD
   - 测试特殊字符在 MOD 名称中的处理

3. **用户体验测试**
   - 验证拖拽排序的流畅性
   - 测试搜索功能
   - 检查错误提示的清晰性

## 部署建议

### 静态托管
由于项目是纯前端应用，可以部署到任何静态托管服务：
- GitHub Pages
- Netlify
- Vercel
- AWS S3 + CloudFront

### 部署步骤
```bash
# 构建生产版本
npm run build

# 上传 dist 文件夹到托管服务
```

## 后续改进建议

1. **功能增强**
   - 支持多个存档文件同时处理
   - 添加 MOD 配置文件导入/导出
   - 支持 MOD 预设保存和加载
   - 添加 MOD 冲突检测

2. **用户体验**
   - 添加撤销/重做功能
   - 支持键盘快捷键
   - 添加拖拽排序的动画效果
   - 支持深色/浅色主题切换

3. **技术优化**
   - 添加单元测试
   - 添加 E2E 测试
   - 优化构建大小
   - 添加 PWA 支持

## 许可证

MIT License

## 联系方式

如有问题或建议，请提交 Issue 或 Pull Request。

---

**项目状态**: ✅ 完成并可用

**最后更新**: 2026-02-26

**版本**: 1.0.0
